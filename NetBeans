<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Login2Explore — Employee Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

  <!-- jQuery + Bootstrap JS -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

 
  <script src="https://login2explore.com/jpdb/resources/js/0.0.3/jpdb-commons.js"></script>

  <style>
    body { padding-top: 24px; }
    pre#rawResp { max-height: 240px; overflow:auto; background:#f8f8f8; padding:10px; border:1px solid #eee; }
    .msg { display:none; margin-top:12px; padding:10px; border-radius:6px; }
    .msg.success { background:#e6ffed; color:#0a6200; }
    .msg.error { background:#ffe6e6; color:#7a0000; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Employee Form (Vertical)</h2>

    <form id="empForm" novalidate>
      <div class="form-group">
        <label for="empId">Employee ID</label>
        <input type="text" class="form-control" id="empId" name="empId" placeholder="Enter Employee ID" required>
      </div>

      <div class="form-group">
        <label for="empName">Employee Name</label>
        <input type="text" class="form-control" id="empName" name="empName" placeholder="Enter Employee Name" required>
      </div>

      <div class="form-group">
        <label for="empEmail">Employee Email</label>
        <input type="email" class="form-control" id="empEmail" name="empEmail" placeholder="Enter Employee Email" required>
      </div>

      <div class="form-group">
        <button type="button" id="empSave" class="btn btn-primary">Save</button>
        <button type="button" id="empReset" class="btn btn-default">Reset</button>
      </div>
    </form>

    <div id="success" class="msg success"></div>
    <div id="error" class="msg error"></div>

    <h4>Raw API response</h4>
    <pre id="rawResp">—</pre>
  </div>

  <script>
    // ---------- CONFIG: replace with your actual token/db/rel ----------
    const JPDB_TOKEN = "90938667|-31949286622448237|90946149"; // <-- REPLACE this with your token
    const JPDB_DB = "SAMPLE";
    const JPDB_REL = "EMP-REL";
    const JPDB_BASE_URL = "http://api.login2explore.com:5577";
    const JPDB_IML_PATH = "/api/iml";
    // -------------------------------------------------------------------

    // helper to show messages
    function showMsg(selector, text) {
      const el = $(selector);
      if (!text) { el.hide().text(''); return; }
      el.text(text).show();
    }

    // reset form
    function resetForm() {
      $('#empForm')[0].reset();
      showMsg('#success', '');
      showMsg('#error', '');
      $('#rawResp').text('—');
      $('#empId').focus();
    }

    // client-side validation + build JSON string
    function validateAndGetFormData() {
      const empId = $('#empId').val().trim();
      if (!empId) { alert('Employee ID Required'); $('#empId').focus(); return ''; }

      const empName = $('#empName').val().trim();
      if (!empName) { alert('Employee Name Required'); $('#empName').focus(); return ''; }

      const empEmail = $('#empEmail').val().trim();
      if (!empEmail) { alert('Employee Email Required'); $('#empEmail').focus(); return ''; }

      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(empEmail)) { alert('Enter valid email'); $('#empEmail').focus(); return ''; }

      const jsonObj = {
        empId: empId,
        empName: empName,
        empEmail: empEmail,
        createdAt: new Date().toISOString()
      };
      return JSON.stringify(jsonObj);
    }

    // event handlers
    $(document).ready(function () {
      $('#empId').focus();

      $('#empReset').on('click', function () {
        resetForm();
      });

      $('#empSave').on('click', function () {
        saveEmployee();
      });
    });

    // main save
    function saveEmployee() {
      showMsg('#success',''); showMsg('#error','');

      const jsonStr = validateAndGetFormData();
      if (jsonStr === '') return; // validation failed

      // build PUT payload using the included helper createPUTRequest (jpdb-commons.js)
      // createPUTRequest(token, jsonStr, dbName, relName)  -> returns request string/object depending on library version.
      const putReq = createPUTRequest(JPDB_TOKEN, jsonStr, JPDB_DB, JPDB_REL);

      // show the JSON string to the user as in original project (optional)
      // alert(putReq);  // uncomment if you want the same alert UX

      // send async AJAX to JPDB API
      $.ajax({
        url: JPDB_BASE_URL + JPDB_IML_PATH,
        method: 'POST',                 // POST to IML endpoint is typical
        contentType: 'application/json',
        data: putReq,
        dataType: 'json',
        success: function (resp) {
          // show raw response
          $('#rawResp').text(JSON.stringify(resp, null, 2));

          // check for success indicators - JPDB responses vary; adapt if needed
          if (resp && (resp.status === 200 || resp.status === 'success' || resp.data || resp.result)) {
            showMsg('#success', 'Entry added successfully.');
            alert('Entry added successfully.');
            resetForm();
          } else {
            // if response contains error info, show it
            showMsg('#error', 'API returned response: ' + JSON.stringify(resp));
          }
        },
        error: function (xhr, status, err) {
          let body = xhr.responseText || err || status;
          try { body = JSON.stringify(JSON.parse(body), null, 2); } catch (e) { /* not JSON */ }
          $('#rawResp').text(body);
          showMsg('#error', 'Request failed: ' + status + '. See raw response below.');
          console.error('JPDB error:', status, err, xhr);
        }
      });
    }
  </script>
</body>
</html>
